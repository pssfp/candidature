<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/application/config/email.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/application/config/email.php" />
              <option name="updatedContent" value="&lt;?php&#10;defined('BASEPATH') OR exit('No direct script access allowed');&#10;&#10;/*&#10;| -------------------------------------------------------------------&#10;| EMAIL CONFING&#10;| -------------------------------------------------------------------&#10;| Configuration of outgoing mail server.&#10;|&#10;*/&#10;$config['protocol'] = 'smtp';&#10;$config['smtp_host'] = 'mail.pfinancespubliques.org';&#10;$config['smtp_port'] = 587; // or 465 for SSL&#10;$config['smtp_user'] = 'info@pfinancespubliques.org';&#10;$config['smtp_pass'] = ''; // You'll need to set the actual password&#10;$config['smtp_crypto'] = 'tls'; // 'tls' or 'ssl'&#10;$config['mailtype'] = 'html';&#10;$config['charset'] = 'utf-8';&#10;$config['newline'] = &quot;\r\n&quot;;&#10;$config['crlf'] = &quot;\r\n&quot;;&#10;$config['wordwrap'] = TRUE;&#10;$config['smtp_timeout'] = 30;&#10;$config['validate'] = FALSE;&#10;$config['priority'] = 3;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/application/controllers/candidature.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/application/controllers/candidature.php" />
              <option name="originalContent" value="&lt;?php&#10;&#10;if (!defined('BASEPATH'))&#10;    exit('No direct script access allowed');&#10;&#10;class Candidature extends MY_Controller {&#10;&#10;    public $form_data;&#10;&#10;    /**&#10;     * Index Page for this controller.&#10;     *&#10;     * Maps to the following URL&#10;     * &#9;&#9;http://example.com/index.php/welcome&#10;     * &#9;- or -&#10;     * &#9;&#9;http://example.com/index.php/welcome/index&#10;     * &#9;- or -&#10;     * Since this controller is set as the default controller in&#10;     * config/routes.php, it's displayed at http://example.com/&#10;     *&#10;     * So any other public methods not prefixed with an underscore will&#10;     * map to /index.php/welcome/&lt;method_name&gt;&#10;     * @see http://codeigniter.com/user_guide/general/urls.html&#10;     */&#10;    public function __construct() {&#10;        parent::__construct();&#10;&#10;        // load library&#10;        $this-&gt;load-&gt;library(array('table', 'form_validation'));&#10;        $this-&gt;load-&gt;library('session');&#10;        $this-&gt;load-&gt;library('email');&#10;        // Remove duplicate email loading&#10;        // load helper&#10;        $this-&gt;load-&gt;helper('url');&#10;&#10;        // load model&#10;        $this-&gt;load-&gt;model('Model_generique', 'model', TRUE);&#10;    }&#10;&#10;    public function index() {&#10;        $this-&gt;reset_form_data();&#10;        $submitname = &quot;enregistrer&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $data[&quot;specialites&quot;] = $this-&gt;model-&gt;list_all(&quot;specialite&quot;)-&gt;result();&#10;        $data[&quot;pays&quot;] = $this-&gt;model-&gt;list_all(&quot;pays&quot;)-&gt;result();&#10;        $data['action'] = site_url('candidature/add/');&#10;        $this-&gt;template-&gt;layout('candidature', $data);&#10;    }&#10;&#10;    /**&#10;     * Send a confirmation email to the user after form submission&#10;     *&#10;     * @param object $candidature The candidate data object&#10;     * @param string $action The action performed (new submission or update)&#10;     * @return boolean True if email sent successfully&#10;     */&#10;    private function send_confirmation_email($candidature, $action = 'new') {&#10;        // Start by logging the attempt&#10;        log_message('info', 'Attempting to send email to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . (is_object($candidature) ? $candidature-&gt;id : $candidature));&#10;&#10;        $email_setting = array(&#10;            'charset' =&gt; 'utf-8',&#10;            'mailtype' =&gt; 'html'&#10;        );&#10;&#10;        // Load email configuration from config file&#10;        $this-&gt;config-&gt;load('email');&#10;&#10;        $this-&gt;email-&gt;initialize($email_setting);&#10;        $this-&gt;email-&gt;from('noreply@pssfp.net', '[PSSFP] DEPOT de CANDIDATURE 13ème PROMOTION 2025/2026');&#10;        $this-&gt;email-&gt;to($this-&gt;input-&gt;post('email'));&#10;        $this-&gt;email-&gt;newline = &quot;\r\n&quot;;&#10;        $this-&gt;email-&gt;crlf = &quot;\n&quot;;&#10;&#10;        // Log recipient email for debugging&#10;        log_message('debug', 'Email recipient: ' . $this-&gt;input-&gt;post('email'));&#10;&#10;        $candidat_id = isset($candidature-&gt;id) ? $candidature-&gt;id : $candidature;&#10;        $specialite_candidat = $this-&gt;model-&gt;get_by_id2('specialite', $this-&gt;input-&gt;post('id_specialite'));&#10;&#10;        // Set the appropriate subject based on action&#10;        if ($action == 'new') {&#10;            $this-&gt;email-&gt;subject('Confirmation de candidature N°' . $candidat_id . ' - PSSFP');&#10;        } else {&#10;            $this-&gt;email-&gt;subject('Mise à jour de candidature N°' . $candidat_id . ' - PSSFP');&#10;        }&#10;&#10;        // Build the email message with improved formatting&#10;        $message = '&#10;        &lt;!DOCTYPE html&gt;&#10;        &lt;html&gt;&#10;        &lt;head&gt;&#10;            &lt;meta charset=&quot;utf-8&quot;&gt;&#10;            &lt;style&gt;&#10;                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }&#10;                .container { width: 100%; max-width: 600px; margin: 0 auto; }&#10;                .header { background-color: #0056b3; color: white; padding: 20px; text-align: center; }&#10;                .content { padding: 20px; }&#10;                .footer { background-color: #f8f9fa; padding: 15px; font-size: 12px; color: #666; text-align: center; }&#10;                table { width: 100%; border-collapse: collapse; margin: 20px 0; }&#10;                table td { padding: 8px; border-bottom: 1px solid #eee; }&#10;                .label { font-weight: bold; width: 40%; }&#10;                .actions { background-color: #f5f5f5; padding: 15px; margin: 20px 0; border-left: 4px solid #0056b3; }&#10;                .btn { display: inline-block; background-color: #0056b3; color: white; padding: 10px 20px; &#10;                       text-decoration: none; border-radius: 4px; margin: 10px 0; }&#10;            &lt;/style&gt;&#10;        &lt;/head&gt;&#10;        &lt;body&gt;&#10;            &lt;div class=&quot;container&quot;&gt;&#10;                &lt;div class=&quot;header&quot;&gt;&#10;                    &lt;h2&gt;' . ($action == 'new' ? 'Confirmation de Candidature' : 'Mise à jour de Candidature') . '&lt;/h2&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;content&quot;&gt;&#10;                    &lt;p&gt;Cher(e) ' . $this-&gt;input-&gt;post('civilite') . ' ' . $this-&gt;input-&gt;post('nom') . ' ' . $this-&gt;input-&gt;post('prenom') . ',&lt;/p&gt;&#10;                    &#10;                    &lt;p&gt;Nous vous informons que votre candidature a bien été ' . ($action == 'new' ? 'enregistrée' : 'mise à jour') . ' avec les détails suivants :&lt;/p&gt;&#10;                    &#10;                    &lt;table&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Dossier N°&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $candidat_id . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;N° de téléphone&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('telephone') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Spécialité&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $specialite_candidat-&gt;nom . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Type de formation&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('type_etude') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Statut professionnel&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('statut_prof') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Administration d\'origine&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('structure') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Nationalité&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('nationalite') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                    &#10;                    &lt;div class=&quot;actions&quot;&gt;&#10;                        &lt;h3&gt;Actions importantes :&lt;/h3&gt;&#10;                        &lt;p&gt;&#10;                            &lt;a href=&quot;' . site_url('impression/imprimer_fiche/' . $candidat_id) . '&quot; class=&quot;btn&quot;&gt;Télécharger votre fiche de candidature&lt;/a&gt;&#10;                        &lt;/p&gt;&#10;                        &lt;p&gt;&#10;                            &lt;a href=&quot;' . site_url('candidature/initupdate/') . '&quot; class=&quot;btn&quot;&gt;Modifier vos informations&lt;/a&gt;&#10;                        &lt;/p&gt;&#10;                        &#10;                        &lt;p&gt;&lt;strong&gt;Pour toute modification ultérieure, veuillez utiliser les identifiants suivants :&lt;/strong&gt;&lt;/p&gt;&#10;                        &lt;ul&gt;&#10;                            &lt;li&gt;&lt;strong&gt;Numéro d\'ordre&lt;/strong&gt; : ' . $candidat_id . '&lt;/li&gt;&#10;                            &lt;li&gt;&lt;strong&gt;N° de téléphone&lt;/strong&gt; : ' . $this-&gt;input-&gt;post('telephone') . '&lt;/li&gt;&#10;                        &lt;/ul&gt;&#10;                    &lt;/div&gt;&#10;                    &#10;                    &lt;p&gt;Nous vous remercions de votre intérêt pour notre programme et restons à votre disposition pour toute information complémentaire.&lt;/p&gt;&#10;                    &#10;                    &lt;p&gt;Cordialement,&lt;br&gt;L\'équipe PSSFP&lt;/p&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;footer&quot;&gt;&#10;                    &lt;p&gt;PSSFP: B.P: 16 578 Yaoundé – Cameroun&lt;br&gt;&#10;                    Tel.: + (237) 697 921 332&lt;br&gt;&#10;                    (237) 677 257 272&lt;br&gt;&#10;                    (237) 671 171 808&lt;/p&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/body&gt;&#10;        &lt;/html&gt;';&#10;&#10;        $this-&gt;email-&gt;message($message);&#10;&#10;        // Try to send the email with enhanced error handling&#10;        try {&#10;            if ($this-&gt;email-&gt;send()) {&#10;                log_message('info', 'Confirmation email sent successfully to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id);&#10;&#10;                var_dump('info', 'Confirmation email sent successfully to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id);&#10;                return true;&#10;            } else {&#10;                $error = $this-&gt;email-&gt;print_debugger();&#10;                log_message('error', 'Failed to send confirmation email to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id . '. Error: ' . $error);&#10;&#10;                // Log SMTP configuration for debugging&#10;                log_message('debug', 'SMTP Host: ' . $this-&gt;config-&gt;item('smtp_host', 'email'));&#10;                log_message('debug', 'SMTP Port: ' . $this-&gt;config-&gt;item('smtp_port', 'email'));&#10;                log_message('debug', 'SMTP User: ' . $this-&gt;config-&gt;item('smtp_user', 'email'));&#10;                log_message('debug', 'SMTP Protocol: ' . $this-&gt;config-&gt;item('protocol', 'email'));&#10;                //var_dump('error', 'Failed to send confirmation email to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id . '. Error: ' . $error);&#10;&#10;                return false;&#10;            }&#10;        } catch (Exception $e) {&#10;            log_message('error', 'Exception when sending email: ' . $e-&gt;getMessage());&#10;            return false;&#10;        }&#10;    }&#10;&#10;    public function add() {&#10;        $this-&gt;load-&gt;library('form_validation');&#10;        $table = 'candidats';&#10;        $data = array();&#10;        $submitname = &quot;enregistrer&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $data[&quot;specialites&quot;] = $this-&gt;model-&gt;list_all(&quot;specialite&quot;)-&gt;result();&#10;        $data[&quot;pays&quot;] = $this-&gt;model-&gt;list_all(&quot;pays&quot;)-&gt;result();&#10;        $data['action'] = site_url('candidature/add/');&#10;&#10;        // Check if form is submitted&#10;        if ($this-&gt;input-&gt;post($submitname)) {&#10;            // Set validation rules&#10;            $this-&gt;form_validation-&gt;set_rules('id_specialite', 'Spécialité', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('type_etude', 'Mode de formation', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('civilite', 'Civilité', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('nom', 'Nom', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('prenom', 'Prénom', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('date_naissance', 'Date de naissance', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('lieu_de_naissce', 'Lieu de naissance', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('nationalite', 'Nationalité', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('paysorigine', 'Pays d\'origine', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('statu_matrimonial', 'Statut matrimonial', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('adresse_candidat', 'Adresse complète', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('ville_residence', 'Ville de résidence', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('pays_residence', 'Pays de résidence', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('telephone', 'Téléphone WhatsApp', 'required|is_unique[candidats.telephone]|is_unique[candidats.telephone2]');&#10;            $this-&gt;form_validation-&gt;set_rules('telephone2', 'Téléphone secondaire', 'trim|differs[telephone]|is_unique[candidats.telephone]|is_unique[candidats.telephone2]');&#10;            $this-&gt;form_validation-&gt;set_rules('email', 'Email', 'required|valid_email|matches[emailverif]|is_unique[candidats.email]');&#10;            $this-&gt;form_validation-&gt;set_rules('emailverif', 'Confirmation Email', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('engagement', 'Engagement', 'required');&#10;&#10;            // Set custom error messages with clear and specific descriptions&#10;            $this-&gt;form_validation-&gt;set_message('required', 'Le champ %s est obligatoire.');&#10;            $this-&gt;form_validation-&gt;set_message('is_unique', 'Ce %s est déjà utilisé par un autre candidat. Veuillez en saisir un autre.');&#10;            $this-&gt;form_validation-&gt;set_message('matches', 'La confirmation de l\'adresse e-mail ne correspond pas à l\'adresse e-mail principale.');&#10;            $this-&gt;form_validation-&gt;set_message('differs', 'Le numéro de téléphone secondaire doit être différent du numéro principal.');&#10;            $this-&gt;form_validation-&gt;set_message('valid_email', 'Veuillez saisir une adresse e-mail valide.');&#10;&#10;            // Store form values for repopulation in case of validation failure&#10;            if ($this-&gt;input-&gt;post()) {&#10;                $this-&gt;form_data = new stdClass();&#10;                foreach ($this-&gt;input-&gt;post() as $key =&gt; $value) {&#10;                    $this-&gt;form_data-&gt;$key = $value;&#10;                }&#10;&#10;                $fields = ['type_etude', 'id_specialite', 'civilite', 'nom', 'prenom', 'epouse', 'nombre_enfant',&#10;                          'date_naissance', 'lieu_de_naissce', 'nationalite', 'paysorigine',&#10;                          'region_dorigine', 'dept_dorigine', 'sexe', 'statu_matrimonial', 'langue', 'pays_residence',&#10;                          'adresse_candidat', 'ville_residence', 'telephone', 'telephone2', 'email', 'emailverif',&#10;                          'dernier_diplome_intitule', 'dernier_diplome_specialite',&#10;                          'dernier_diplome_domaine', 'dernier_diplome_autre_domaine', 'dernier_diplome_etablissement',&#10;                          'dernier_diplome_pays', 'dernier_diplome_annee', 'dernier_diplome_niveau', 'dernier_diplome_mention',&#10;                          'statut_prof', 'autre_statut_prof', 'structure', 'adresse_structure', 'telephone_structure',&#10;                          'email_structure', 'poste_actuel', 'date_debut_poste', 'lien_finances_publiques',&#10;                          'explication_lien_partiel', 'total_annees_experience', 'howDidYouKnewUs', 'howDidYouKnewUs_autre'];&#10;&#10;                foreach ($fields as $field) {&#10;                    if (!isset($this-&gt;form_data-&gt;$field)) {&#10;                        $this-&gt;form_data-&gt;$field = '';&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Run validation&#10;            if ($this-&gt;form_validation-&gt;run() == TRUE) {&#10;                // Only save data if validation passes&#10;                $candidat_data = array();&#10;                $fields = ['type_etude', 'id_specialite', 'civilite', 'nom', 'prenom', 'epouse', 'nombre_enfant',&#10;                          'lieu_de_naissce', 'nationalite', 'paysorigine', 'region_dorigine', 'dept_dorigine', 'sexe',&#10;                          'statu_matrimonial', 'langue', 'pays_residence', 'adresse_candidat', 'ville_residence',&#10;                          'telephone', 'telephone2', 'email', 'dernier_diplome_intitule', 'dernier_diplome_specialite',&#10;                          'dernier_diplome_domaine', 'dernier_diplome_autre_domaine', 'dernier_diplome_etablissement',&#10;                          'dernier_diplome_pays', 'dernier_diplome_annee', 'dernier_diplome_niveau', 'dernier_diplome_mention',&#10;                          'statut_prof', 'autre_statut_prof', 'structure', 'adresse_structure', 'telephone_structure',&#10;                          'email_structure', 'poste_actuel', 'date_debut_poste', 'lien_finances_publiques',&#10;                          'explication_lien_partiel', 'total_annees_experience', 'howDidYouKnewUs', 'howDidYouKnewUs_autre'];&#10;&#10;                foreach ($fields as $field) {&#10;                    if ($this-&gt;input-&gt;post($field) !== NULL) {&#10;                        $candidat_data[$field] = $this-&gt;input-&gt;post($field);&#10;                    }&#10;                }&#10;&#10;                $candidat_data['date_naissance'] = $this-&gt;input-&gt;post('date_naissance');&#10;                $candidat_data['sexe'] = ($this-&gt;input-&gt;post('civilite') === &quot;Monsieur&quot;) ? &quot;Homme&quot; : &quot;Femme&quot;;&#10;                $candidat_data['accepter_condition'] = true;&#10;                $candidat_data['ordre_candidature'] = null;&#10;                $candidat_data['date_enregistrement'] = date(&quot;Y-m-d H:i:s&quot;);&#10;                $candidat_data['id_pays'] = $this-&gt;input-&gt;post('pays_residence');&#10;                $candidat_data['a_depose'] = false;&#10;&#10;                // Create the new record&#10;                $candidat_id = $this-&gt;model-&gt;create($table, $candidat_data);&#10;&#10;                if ($candidat_id) {&#10;                    // Send confirmation email to the candidate&#10;                    $email_sent = $this-&gt;send_confirmation_email($candidat_id, 'new');&#10;&#10;                    // Store info in session for the success page&#10;                    $this-&gt;session-&gt;set_flashdata('id', $candidat_id);&#10;                    $this-&gt;session-&gt;set_flashdata('numordre', $candidat_id);&#10;                    $this-&gt;session-&gt;set_flashdata('telephone', $this-&gt;input-&gt;post('telephone'));&#10;                    $this-&gt;session-&gt;set_flashdata('email', $this-&gt;input-&gt;post('email'));&#10;                    $this-&gt;session-&gt;set_flashdata('email_sent', $email_sent);&#10;&#10;                    // If email sending failed, get the error message&#10;                    if (!$email_sent) {&#10;                        $error = $this-&gt;email-&gt;print_debugger();&#10;                        $this-&gt;session-&gt;set_flashdata('email_error', $error);&#10;                        log_message('error', 'Email sending failed for candidate ID: ' . $candidat_id . '. Error: ' . $error);&#10;                    } else {&#10;                        log_message('info', 'Email successfully sent for candidate ID: ' . $candidat_id);&#10;                    }&#10;&#10;                    // Use POST/Redirect/GET pattern to prevent form resubmission&#10;                    redirect('candidature/success');&#10;                } else {&#10;                    // Database insertion failed&#10;                    $data['error'] = 'Échec de l\'enregistrement de la candidature. Veuillez réessayer.';&#10;                    $this-&gt;template-&gt;layout('candidature', $data);&#10;                }&#10;            } else {&#10;                // Validation failed - just display the form with errors&#10;                $this-&gt;template-&gt;layout('candidature', $data);&#10;            }&#10;        } else {&#10;            // First time loading the form - reset form data&#10;            $this-&gt;reset_form_data();&#10;            $this-&gt;template-&gt;layout('candidature', $data);&#10;        }&#10;    }&#10;&#10;    public function success() {&#10;        // Add detailed logging about the session data for debugging&#10;        log_message('debug', 'Success page accessed. Session data: ' . &#10;            'numordre=' . $this-&gt;session-&gt;flashdata('numordre') . ', ' .&#10;            'email=' . $this-&gt;session-&gt;flashdata('email') . ', ' . &#10;            'email_sent=' . ($this-&gt;session-&gt;flashdata('email_sent') ? 'true' : 'false'));&#10;            &#10;        $this-&gt;template-&gt;layout('success_page', array()); // Create a success view&#10;    }&#10;&#10;    public function viewnumordre(){&#10;        $data=array();&#10;        $this-&gt;template-&gt;layout('numOrdreCandidature', $data);&#10;    }&#10;&#10;    public function initupdate() {&#10;        $this-&gt;form_data = new stdclass;&#10;        $this-&gt;form_data-&gt;numordre = '';&#10;        $this-&gt;form_data-&gt;telephone = '';&#10;        $submitname = &quot;modifier&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $data['action'] = site_url('candidature/verifinitupdate/');&#10;        $this-&gt;template-&gt;layout('firstformupdate', $data);&#10;    }&#10;&#10;    public function verifinitupdate() {&#10;        $table = 'candidats';&#10;        $submitname = &quot;modifier&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $numordre = $this-&gt;input-&gt;post('numordre');&#10;        $phone = $this-&gt;input-&gt;post('telephone');&#10;        $candidature = $this-&gt;model-&gt;get_by_id($table, $numordre, 'ordre_candidature')-&gt;row();&#10;        if ($candidature == null || $candidature-&gt;telephone !== $phone) {&#10;            $this-&gt;form_data = new stdclass;&#10;            $this-&gt;form_data-&gt;numordre = $this-&gt;input-&gt;post('numordre');&#10;            $this-&gt;form_data-&gt;telephone = $this-&gt;input-&gt;post('telephone');&#10;            $data['action'] = site_url('candidature/verifinitupdate/');&#10;            $data['message'] = &quot;Vérifier vos informations&quot;;&#10;            $this-&gt;template-&gt;layout('firstformupdate', $data);&#10;        } else {&#10;            redirect('candidature/update/'.$numordre.&quot;/&quot;.$phone);&#10;        }&#10;    }&#10;&#10;    public function marquerdeposer($id_candidat) {&#10;        $this-&gt;load-&gt;model('impression_model', '', TRUE);&#10;        $candidat = array(&#10;            'a_depose' =&gt; true&#10;        );&#10;        $this-&gt;model-&gt;update(&quot;candidats&quot;, 'id', $id_candidat, $candidat);&#10;        redirect('liste');&#10;    }&#10;&#10;    public function update($numordre = 0, $phone = '') {&#10;        $table = 'candidats';&#10;        $submitname = &quot;modifier&quot;;&#10;        $data['submitname'] = $submitname;&#10;&#10;        // Get candidate data&#10;        $candidature = $this-&gt;model-&gt;get_by_id($table, $numordre, 'ordre_candidature')-&gt;row();&#10;        if (!$candidature) {&#10;            // No candidate found with this order number&#10;            $this-&gt;session-&gt;set_flashdata('error', 'Aucune candidature trouvée avec ce numéro d\'ordre.');&#10;            redirect('candidature/initupdate');&#10;            return;&#10;        }&#10;&#10;        $data[&quot;specialites&quot;] = $this-&gt;model-&gt;list_all(&quot;specialite&quot;)-&gt;result();&#10;        $data[&quot;pays&quot;] = $this-&gt;model-&gt;list_all(&quot;pays&quot;)-&gt;result();&#10;        $data['action'] = site_url('candidature/update/'.$numordre.&quot;/&quot;.$phone);&#10;&#10;        // Load all current data into form_data&#10;        $this-&gt;form_data = new stdclass;&#10;        $this-&gt;form_data-&gt;type_etude = $candidature-&gt;type_etude;&#10;        $this-&gt;form_data-&gt;specialite = $candidature-&gt;id_specialite;&#10;        $this-&gt;form_data-&gt;civilite = $candidature-&gt;civilite;&#10;        $this-&gt;form_data-&gt;nom = $candidature-&gt;nom;&#10;        $this-&gt;form_data-&gt;prenom = $candidature-&gt;prenom;&#10;        $this-&gt;form_data-&gt;epouse = $candidature-&gt;epouse;&#10;        $this-&gt;form_data-&gt;nombre_enfant = $candidature-&gt;nombre_enfant;&#10;        $this-&gt;form_data-&gt;date_naissance = $candidature-&gt;date_naissance; // Use the date directly&#10;        $this-&gt;form_data-&gt;lieu_de_naissce = $candidature-&gt;lieu_de_naissce;&#10;        $this-&gt;form_data-&gt;nationalite = $candidature-&gt;nationalite;&#10;        $this-&gt;form_data-&gt;paysorigine = $candidature-&gt;paysorigine;&#10;        $this-&gt;form_data-&gt;region_dorigine = $candidature-&gt;region_dorigine;&#10;        $this-&gt;form_data-&gt;dept_dorigine = $candidature-&gt;dept_dorigine;&#10;        $this-&gt;form_data-&gt;sexe = $candidature-&gt;sexe;&#10;        $this-&gt;form_data-&gt;statu_matrimonial = $candidature-&gt;statu_matrimonial;&#10;        $this-&gt;form_data-&gt;langue = $candidature-&gt;langue;&#10;        $this-&gt;form_data-&gt;pays_residence = $candidature-&gt;id_pays;&#10;        $this-&gt;form_data-&gt;adresse_candidat = $candidature-&gt;adresse_candidat;&#10;        $this-&gt;form_data-&gt;ville_residence = $candidature-&gt;ville_residence;&#10;        $this-&gt;form_data-&gt;telephone = $candidature-&gt;telephone;&#10;        $this-&gt;form_data-&gt;telephone2 = $candidature-&gt;telephone2;&#10;        $this-&gt;form_data-&gt;email = $candidature-&gt;email;&#10;        $this-&gt;form_data-&gt;emailverif = $candidature-&gt;email;&#10;        $this-&gt;form_data-&gt;dernier_diplome_intitule = $candidature-&gt;dernier_diplome_intitule;&#10;        $this-&gt;form_data-&gt;dernier_diplome_specialite = $candidature-&gt;dernier_diplome_specialite;&#10;        $this-&gt;form_data-&gt;dernier_diplome_domaine = $candidature-&gt;dernier_diplome_domaine;&#10;        $this-&gt;form_data-&gt;dernier_diplome_autre_domaine = $candidature-&gt;dernier_diplome_autre_domaine;&#10;        $this-&gt;form_data-&gt;dernier_diplome_etablissement = $candidature-&gt;dernier_diplome_etablissement;&#10;        $this-&gt;form_data-&gt;dernier_diplome_pays = $candidature-&gt;dernier_diplome_pays;&#10;        $this-&gt;form_data-&gt;dernier_diplome_annee = $candidature-&gt;dernier_diplome_annee;&#10;        $this-&gt;form_data-&gt;dernier_diplome_niveau = $candidature-&gt;dernier_diplome_niveau;&#10;        $this-&gt;form_data-&gt;dernier_diplome_mention = $candidature-&gt;dernier_diplome_mention;&#10;        $this-&gt;form_data-&gt;statut_prof = $candidature-&gt;statut_prof;&#10;        $this-&gt;form_data-&gt;autre_statut_prof = $candidature-&gt;autre_statut_prof;&#10;        $this-&gt;form_data-&gt;structure = $candidature-&gt;structure;&#10;        $this-&gt;form_data-&gt;adresse_structure = $candidature-&gt;adresse_structure;&#10;        $this-&gt;form_data-&gt;telephone_structure = $candidature-&gt;telephone_structure;&#10;        $this-&gt;form_data-&gt;email_structure = $candidature-&gt;email_structure;&#10;        $this-&gt;form_data-&gt;poste_actuel = $candidature-&gt;poste_actuel;&#10;        $this-&gt;form_data-&gt;date_debut_poste = $candidature-&gt;date_debut_poste;&#10;        $this-&gt;form_data-&gt;lien_finances_publiques = $candidature-&gt;lien_finances_publiques;&#10;        $this-&gt;form_data-&gt;explication_lien_partiel = $candidature-&gt;explication_lien_partiel;&#10;        $this-&gt;form_data-&gt;total_annees_experience = $candidature-&gt;total_annees_experience;&#10;        $this-&gt;form_data-&gt;howDidYouKnewUs = $candidature-&gt;howDidYouKnewUs;&#10;        $this-&gt;form_data-&gt;howDidYouKnewUs_autre = $candidature-&gt;howDidYouKnewUs_autre;&#10;        //$this-&gt;form_data-&gt;accepter_condition              Pas besoin d'enregistrer cette variable&#10;&#10;        if (isset($_POST[$submitname])) {&#10;            // Validation rules for update - exclude current record from uniqueness check&#10;            $this-&gt;form_validation-&gt;set_rules('telephone', 'Numéro de téléphone principal', 'trim|required|is_unique[candidats.telephone.id.' . $candidature-&gt;id . ']|is_unique[candidats.telephone2.id.' . $candidature-&gt;id . ']');&#10;            $this-&gt;form_validation-&gt;set_rules('telephone2', 'Numéro de téléphone secondaire', 'trim|is_unique[candidats.telephone2.id.' . $candidature-&gt;id . ']|is_unique[candidats.telephone.id.' . $candidature-&gt;id . ']|differs[telephone]');&#10;            $this-&gt;form_validation-&gt;set_rules('email', 'Adresse e-mail', 'trim|required|valid_email|is_unique[candidats.email.id.' . $candidature-&gt;id . ']');&#10;            $this-&gt;form_validation-&gt;set_rules('emailverif', 'Confirmation de l\'adresse e-mail', 'trim|required|valid_email|matches[email]');&#10;            $this-&gt;form_validation-&gt;set_rules('date_naissance', 'Date de naissance', 'required');&#10;&#10;            // Set custom error messages with clear and specific descriptions&#10;            $this-&gt;form_validation-&gt;set_message('required', 'Le champ %s est obligatoire.');&#10;            $this-&gt;form_validation-&gt;set_message('is_unique', 'Ce %s est déjà utilisé par un autre candidat. Veuillez en saisir un autre.');&#10;            $this-&gt;form_validation-&gt;set_message('matches', 'La confirmation de l\'adresse e-mail ne correspond pas à l\'adresse e-mail principale.');&#10;            $this-&gt;form_validation-&gt;set_message('differs', 'Le numéro de téléphone secondaire doit être différent du numéro principal.');&#10;            $this-&gt;form_validation-&gt;set_message('valid_email', 'Veuillez saisir une adresse e-mail valide.');&#10;&#10;            // Store form values for repopulation in case of validation failure&#10;            foreach ($this-&gt;input-&gt;post() as $key =&gt; $value) {&#10;                $this-&gt;form_data-&gt;$key = $value;&#10;            }&#10;&#10;            if ($this-&gt;form_validation-&gt;run() == TRUE) {&#10;                // Build update data array with all fields&#10;                $candidat = array(&#10;                    'civilite' =&gt; $this-&gt;input-&gt;post('civilite'),&#10;                    'type_etude' =&gt; $this-&gt;input-&gt;post('type_etude'),&#10;                    'nom' =&gt; $this-&gt;input-&gt;post('nom'),&#10;                    'prenom' =&gt; $this-&gt;input-&gt;post('prenom'),&#10;                    'epouse' =&gt; $this-&gt;input-&gt;post('epouse'),&#10;                    'nombre_enfant' =&gt; $this-&gt;input-&gt;post('nombre_enfant'),&#10;                    'date_naissance' =&gt; $this-&gt;input-&gt;post('date_naissance'),&#10;                    'lieu_de_naissce' =&gt; $this-&gt;input-&gt;post('lieu_de_naissce'),&#10;                    'nationalite' =&gt; $this-&gt;input-&gt;post('nationalite'),&#10;                    'paysorigine' =&gt; $this-&gt;input-&gt;post('paysorigine'),&#10;                    'region_dorigine' =&gt; $this-&gt;input-&gt;post('region_dorigine'),&#10;                    'dept_dorigine' =&gt; $this-&gt;input-&gt;post('dept_dorigine'),&#10;                    'statu_matrimonial' =&gt; $this-&gt;input-&gt;post('statu_matrimonial'),&#10;                    'adresse_candidat' =&gt; $this-&gt;input-&gt;post('adresse_candidat'),&#10;                    'telephone' =&gt; $this-&gt;input-&gt;post('telephone'),&#10;                    'telephone2' =&gt; $this-&gt;input-&gt;post('telephone2'),&#10;                    'email' =&gt; $this-&gt;input-&gt;post('email'),&#10;                    'ville_residence' =&gt; $this-&gt;input-&gt;post('ville_residence'),&#10;                    'dernier_diplome_intitule' =&gt; $this-&gt;input-&gt;post('dernier_diplome_intitule'),&#10;                    'dernier_diplome_specialite' =&gt; $this-&gt;input-&gt;post('dernier_diplome_specialite'),&#10;                    'dernier_diplome_domaine' =&gt; $this-&gt;input-&gt;post('dernier_diplome_domaine'),&#10;                    'dernier_diplome_autre_domaine' =&gt; $this-&gt;input-&gt;post('dernier_diplome_autre_domaine'),&#10;                    'dernier_diplome_etablissement' =&gt; $this-&gt;input-&gt;post('dernier_diplome_etablissement'),&#10;                    'dernier_diplome_pays' =&gt; $this-&gt;input-&gt;post('dernier_diplome_pays'),&#10;                    'dernier_diplome_annee' =&gt; $this-&gt;input-&gt;post('dernier_diplome_annee'),&#10;                    'dernier_diplome_niveau' =&gt; $this-&gt;input-&gt;post('dernier_diplome_niveau'),&#10;                    'dernier_diplome_mention' =&gt; $this-&gt;input-&gt;post('dernier_diplome_mention'),&#10;                    'statut_prof' =&gt; $this-&gt;input-&gt;post('statut_prof'),&#10;                    'autre_statut_prof' =&gt; $this-&gt;input-&gt;post('autre_statut_prof'),&#10;                    'structure' =&gt; $this-&gt;input-&gt;post('structure'),&#10;                    'adresse_structure' =&gt; $this-&gt;input-&gt;post('adresse_structure'),&#10;                    'email_structure' =&gt; $this-&gt;input-&gt;post('email_structure'),&#10;                    'telephone_structure' =&gt; $this-&gt;input-&gt;post('telephone_structure'),&#10;                    'poste_actuel' =&gt; $this-&gt;input-&gt;post('poste_actuel'),&#10;                    'date_debut_poste' =&gt; $this-&gt;input-&gt;post('date_debut_poste'),&#10;                    'lien_finances_publiques' =&gt; $this-&gt;input-&gt;post('lien_finances_publiques'),&#10;                    'explication_lien_partiel' =&gt; $this-&gt;input-&gt;post('explication_lien_partiel'),&#10;                    'total_annees_experience' =&gt; $this-&gt;input-&gt;post('total_annees_experience'),&#10;                    'howDidYouKnewUs' =&gt; $this-&gt;input-&gt;post('howDidYouKnewUs'),&#10;                    'howDidYouKnewUs_autre' =&gt; $this-&gt;input-&gt;post('howDidYouKnewUs_autre'),&#10;                    'langue' =&gt; $this-&gt;input-&gt;post('langue'),&#10;                    'id_specialite' =&gt; $this-&gt;input-&gt;post('pays_residence'),&#10;                    'id_pays' =&gt; $this-&gt;input-&gt;post('pays_residence'),&#10;                    'pays_residence' =&gt; $this-&gt;model-&gt;get_by_id(&quot;pays&quot;, $this-&gt;input-&gt;post('pays_residence'), &quot;id&quot;)-&gt;row()-&gt;nom,&#10;                    'date_enregistrement' =&gt; date(&quot;Y-m-d H:i:s&quot;),&#10;                    'sexe' =&gt; ($this-&gt;input-&gt;post('civilite') === &quot;Monsieur&quot;) ? &quot;Homme&quot; : &quot;Femme&quot;,&#10;                    'accepter_condition' =&gt; true&#10;                );&#10;&#10;                // Update the record&#10;                $update_result = $this-&gt;model-&gt;update($table, 'id', $candidature-&gt;id, $candidat);&#10;&#10;                if ($update_result) {&#10;                    // Send confirmation email to the candidate&#10;                    $email_sent = $this-&gt;send_confirmation_email($candidature, 'update');&#10;&#10;                    $this-&gt;session-&gt;set_flashdata('succes', 'Modification de la Candidature enregistrée avec succès, votre numéro d\'ordre a été envoyé à votre adresse mail!');&#10;                    $this-&gt;session-&gt;set_flashdata('id', $candidature-&gt;ordre_candidature);&#10;                    $this-&gt;session-&gt;set_flashdata('numordre', $candidature-&gt;ordre_candidature);&#10;                    $this-&gt;session-&gt;set_flashdata('telephone', $this-&gt;input-&gt;post('telephone'));&#10;                    $this-&gt;session-&gt;set_flashdata('email', $this-&gt;input-&gt;post('email'));&#10;                    $this-&gt;session-&gt;set_flashdata('email_sent', $email_sent);&#10;&#10;                    // If email sending failed, get the error message&#10;                    if (!$email_sent) {&#10;                        $error = $this-&gt;email-&gt;print_debugger();&#10;                        $this-&gt;session-&gt;set_flashdata('email_error', $error);&#10;                        log_message('error', 'Email sending failed for update of candidate ID: ' . $candidature-&gt;id . '. Error: ' . $error);&#10;                    } else {&#10;                        log_message('info', 'Email successfully sent for update of candidate ID: ' . $candidature-&gt;id);&#10;                    }&#10;&#10;                    // Redirect to prevent form resubmission&#10;                    redirect('candidature/viewnumordre');&#10;                } else {&#10;                    // Database update failed&#10;                    $data['message'] = 'Échec de la mise à jour de la candidature. Veuillez réessayer.';&#10;                    $this-&gt;template-&gt;layout('candidature', $data);&#10;                }&#10;            } else {&#10;                // Validation failed&#10;                $data['message'] = 'Des erreurs ont été rencontrées lors de l\'enregistrement de votre fiche&lt;br/&gt; verifier vos informations et corriger les problèmes signalés';&#10;                $this-&gt;template-&gt;layout('candidature', $data);&#10;            }&#10;        } else {&#10;            // Initial page load - just display the form&#10;            $this-&gt;template-&gt;layout('candidature', $data);&#10;        }&#10;    }&#10;&#10;    public function initRecupOrdre(){&#10;        $data=array();&#10;        $this-&gt;template-&gt;layout('formEmailForNumOrdre', array());&#10;    }&#10;&#10;    /**&#10;     * Reset form data by initializing all properties to empty values&#10;     */&#10;    private function reset_form_data() {&#10;        // Initialize form_data object if it doesn't exist&#10;        if (!isset($this-&gt;form_data)) {&#10;            $this-&gt;form_data = new stdClass();&#10;        }&#10;&#10;        // Reset all form fields to empty values&#10;        $this-&gt;form_data-&gt;specialite = '';&#10;        $this-&gt;form_data-&gt;type_etude = '';&#10;        $this-&gt;form_data-&gt;civilite = '';&#10;        $this-&gt;form_data-&gt;nom = '';&#10;        $this-&gt;form_data-&gt;prenom = '';&#10;        $this-&gt;form_data-&gt;epouse = '';&#10;        $this-&gt;form_data-&gt;nombre_enfant = '';&#10;        $this-&gt;form_data-&gt;datenaiss_jj = '';&#10;        $this-&gt;form_data-&gt;datenaiss_mm = '';&#10;        $this-&gt;form_data-&gt;datenaiss_yy = '';&#10;        $this-&gt;form_data-&gt;lieu_de_naissce = '';&#10;        $this-&gt;form_data-&gt;nationalite = '';&#10;        $this-&gt;form_data-&gt;paysorigine = '';&#10;        $this-&gt;form_data-&gt;region_dorigine = '';&#10;        $this-&gt;form_data-&gt;dept_dorigine = '';&#10;        $this-&gt;form_data-&gt;sexe = '';&#10;        $this-&gt;form_data-&gt;statu_matrimonial = '';&#10;        $this-&gt;form_data-&gt;langue = '';&#10;        $this-&gt;form_data-&gt;pays_residence = '';&#10;        $this-&gt;form_data-&gt;adresse_candidat = '';&#10;        $this-&gt;form_data-&gt;ville_residence = '';&#10;        $this-&gt;form_data-&gt;telephone = '';&#10;        $this-&gt;form_data-&gt;telephone2 = '';&#10;        $this-&gt;form_data-&gt;email = '';&#10;        $this-&gt;form_data-&gt;emailverif = '';&#10;        $this-&gt;form_data-&gt;nombre_annee_etude_sup = '';&#10;        $this-&gt;form_data-&gt;dernier_diplome = '';&#10;        $this-&gt;form_data-&gt;specialite_requise = '';&#10;        $this-&gt;form_data-&gt;diplome_requis = '';&#10;        $this-&gt;form_data-&gt;diplome_obtenu_a = '';&#10;        $this-&gt;form_data-&gt;annee_optention_diplome = '';&#10;        $this-&gt;form_data-&gt;statut_prof = '';&#10;        $this-&gt;form_data-&gt;structure = '';&#10;        $this-&gt;form_data-&gt;adresse_structure = '';&#10;        $this-&gt;form_data-&gt;telephone_structure = '';&#10;        $this-&gt;form_data-&gt;email_structure = '';&#10;        $this-&gt;form_data-&gt;howDidYouKnewUs = '';&#10;    }&#10;&#10;}&#10;" />
              <option name="updatedContent" value="&lt;?php&#10;&#10;if (!defined('BASEPATH'))&#10;    exit('No direct script access allowed');&#10;&#10;class Candidature extends MY_Controller {&#10;&#10;    public $form_data;&#10;&#10;    /**&#10;     * Index Page for this controller.&#10;     *&#10;     * Maps to the following URL&#10;     * &#9;&#9;http://example.com/index.php/welcome&#10;     * &#9;- or -&#10;     * &#9;&#9;http://example.com/index.php/welcome/index&#10;     * &#9;- or -&#10;     * Since this controller is set as the default controller in&#10;     * config/routes.php, it's displayed at http://example.com/&#10;     *&#10;     * So any other public methods not prefixed with an underscore will&#10;     * map to /index.php/welcome/&lt;method_name&gt;&#10;     * @see http://codeigniter.com/user_guide/general/urls.html&#10;     */&#10;    public function __construct() {&#10;        parent::__construct();&#10;&#10;        // load library&#10;        $this-&gt;load-&gt;library(array('table', 'form_validation'));&#10;        $this-&gt;load-&gt;library('session');&#10;        $this-&gt;load-&gt;library('email');&#10;        // Remove duplicate email loading&#10;        // load helper&#10;        $this-&gt;load-&gt;helper('url');&#10;&#10;        // load model&#10;        $this-&gt;load-&gt;model('Model_generique', 'model', TRUE);&#10;    }&#10;&#10;    public function index() {&#10;        $this-&gt;reset_form_data();&#10;        $submitname = &quot;enregistrer&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $data[&quot;specialites&quot;] = $this-&gt;model-&gt;list_all(&quot;specialite&quot;)-&gt;result();&#10;        $data[&quot;pays&quot;] = $this-&gt;model-&gt;list_all(&quot;pays&quot;)-&gt;result();&#10;        $data['action'] = site_url('candidature/add/');&#10;        $this-&gt;template-&gt;layout('candidature', $data);&#10;    }&#10;&#10;    /**&#10;     * Send a confirmation email to the user after form submission&#10;     *&#10;     * @param object $candidature The candidate data object&#10;     * @param string $action The action performed (new submission or update)&#10;     * @return boolean True if email sent successfully&#10;     */&#10;    private function send_confirmation_email($candidature, $action = 'new') {&#10;        // Start by logging the attempt&#10;        log_message('info', 'Attempting to send email to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . (is_object($candidature) ? $candidature-&gt;id : $candidature));&#10;&#10;        $email_setting = array(&#10;            'charset' =&gt; 'utf-8',&#10;            'mailtype' =&gt; 'html'&#10;        );&#10;&#10;        // Load email configuration from config file&#10;        $this-&gt;config-&gt;load('email');&#10;&#10;        $this-&gt;email-&gt;initialize($email_setting);&#10;        $this-&gt;email-&gt;from('noreply@pssfp.net', '[PSSFP] DEPOT de CANDIDATURE 13ème PROMOTION 2025/2026');&#10;        $this-&gt;email-&gt;to($this-&gt;input-&gt;post('email'));&#10;        $this-&gt;email-&gt;newline = &quot;\r\n&quot;;&#10;        $this-&gt;email-&gt;crlf = &quot;\n&quot;;&#10;&#10;        // Log recipient email for debugging&#10;        log_message('debug', 'Email recipient: ' . $this-&gt;input-&gt;post('email'));&#10;&#10;        $candidat_id = isset($candidature-&gt;id) ? $candidature-&gt;id : $candidature;&#10;        $specialite_candidat = $this-&gt;model-&gt;get_by_id2('specialite', $this-&gt;input-&gt;post('id_specialite'));&#10;&#10;        // Set the appropriate subject based on action&#10;        if ($action == 'new') {&#10;            $this-&gt;email-&gt;subject('Confirmation de candidature N°' . $candidat_id . ' - PSSFP');&#10;        } else {&#10;            $this-&gt;email-&gt;subject('Mise à jour de candidature N°' . $candidat_id . ' - PSSFP');&#10;        }&#10;&#10;        // Build the email message with improved formatting&#10;        $message = '&#10;        &lt;!DOCTYPE html&gt;&#10;        &lt;html&gt;&#10;        &lt;head&gt;&#10;            &lt;meta charset=&quot;utf-8&quot;&gt;&#10;            &lt;style&gt;&#10;                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }&#10;                .container { width: 100%; max-width: 600px; margin: 0 auto; }&#10;                .header { background-color: #0056b3; color: white; padding: 20px; text-align: center; }&#10;                .content { padding: 20px; }&#10;                .footer { background-color: #f8f9fa; padding: 15px; font-size: 12px; color: #666; text-align: center; }&#10;                table { width: 100%; border-collapse: collapse; margin: 20px 0; }&#10;                table td { padding: 8px; border-bottom: 1px solid #eee; }&#10;                .label { font-weight: bold; width: 40%; }&#10;                .actions { background-color: #f5f5f5; padding: 15px; margin: 20px 0; border-left: 4px solid #0056b3; }&#10;                .btn { display: inline-block; background-color: #0056b3; color: white; padding: 10px 20px; &#10;                       text-decoration: none; border-radius: 4px; margin: 10px 0; }&#10;            &lt;/style&gt;&#10;        &lt;/head&gt;&#10;        &lt;body&gt;&#10;            &lt;div class=&quot;container&quot;&gt;&#10;                &lt;div class=&quot;header&quot;&gt;&#10;                    &lt;h2&gt;' . ($action == 'new' ? 'Confirmation de Candidature' : 'Mise à jour de Candidature') . '&lt;/h2&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;content&quot;&gt;&#10;                    &lt;p&gt;Cher(e) ' . $this-&gt;input-&gt;post('civilite') . ' ' . $this-&gt;input-&gt;post('nom') . ' ' . $this-&gt;input-&gt;post('prenom') . ',&lt;/p&gt;&#10;                    &#10;                    &lt;p&gt;Nous vous informons que votre candidature a bien été ' . ($action == 'new' ? 'enregistrée' : 'mise à jour') . ' avec les détails suivants :&lt;/p&gt;&#10;                    &#10;                    &lt;table&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Dossier N°&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $candidat_id . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;N° de téléphone&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('telephone') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Spécialité&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $specialite_candidat-&gt;nom . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Type de formation&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('type_etude') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Statut professionnel&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('statut_prof') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Administration d\'origine&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('structure') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td class=&quot;label&quot;&gt;Nationalité&lt;/td&gt;&#10;                            &lt;td&gt;: ' . $this-&gt;input-&gt;post('nationalite') . '&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                    &#10;                    &lt;div class=&quot;actions&quot;&gt;&#10;                        &lt;h3&gt;Actions importantes :&lt;/h3&gt;&#10;                        &lt;p&gt;&#10;                            &lt;a href=&quot;' . site_url('impression/imprimer_fiche/' . $candidat_id) . '&quot; class=&quot;btn&quot;&gt;Télécharger votre fiche de candidature&lt;/a&gt;&#10;                        &lt;/p&gt;&#10;                        &lt;p&gt;&#10;                            &lt;a href=&quot;' . site_url('candidature/initupdate/') . '&quot; class=&quot;btn&quot;&gt;Modifier vos informations&lt;/a&gt;&#10;                        &lt;/p&gt;&#10;                        &#10;                        &lt;p&gt;&lt;strong&gt;Pour toute modification ultérieure, veuillez utiliser les identifiants suivants :&lt;/strong&gt;&lt;/p&gt;&#10;                        &lt;ul&gt;&#10;                            &lt;li&gt;&lt;strong&gt;Numéro d\'ordre&lt;/strong&gt; : ' . $candidat_id . '&lt;/li&gt;&#10;                            &lt;li&gt;&lt;strong&gt;N° de téléphone&lt;/strong&gt; : ' . $this-&gt;input-&gt;post('telephone') . '&lt;/li&gt;&#10;                        &lt;/ul&gt;&#10;                    &lt;/div&gt;&#10;                    &#10;                    &lt;p&gt;Nous vous remercions de votre intérêt pour notre programme et restons à votre disposition pour toute information complémentaire.&lt;/p&gt;&#10;                    &#10;                    &lt;p&gt;Cordialement,&lt;br&gt;L\'équipe PSSFP&lt;/p&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;footer&quot;&gt;&#10;                    &lt;p&gt;PSSFP: B.P: 16 578 Yaoundé – Cameroun&lt;br&gt;&#10;                    Tel.: + (237) 697 921 332&lt;br&gt;&#10;                    (237) 677 257 272&lt;br&gt;&#10;                    (237) 671 171 808&lt;/p&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/body&gt;&#10;        &lt;/html&gt;';&#10;&#10;        $this-&gt;email-&gt;message($message);&#10;&#10;        // Try to send the email with enhanced error handling&#10;        try {&#10;            if ($this-&gt;email-&gt;send()) {&#10;                log_message('info', 'Confirmation email sent successfully to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id);&#10;&#10;                var_dump('info', 'Confirmation email sent successfully to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id);&#10;                return true;&#10;            } else {&#10;                $error = $this-&gt;email-&gt;print_debugger();&#10;                log_message('error', 'Failed to send confirmation email to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id . '. Error: ' . $error);&#10;&#10;                // Log SMTP configuration for debugging&#10;                log_message('debug', 'SMTP Host: ' . $this-&gt;config-&gt;item('smtp_host', 'email'));&#10;                log_message('debug', 'SMTP Port: ' . $this-&gt;config-&gt;item('smtp_port', 'email'));&#10;                log_message('debug', 'SMTP User: ' . $this-&gt;config-&gt;item('smtp_user', 'email'));&#10;                log_message('debug', 'SMTP Protocol: ' . $this-&gt;config-&gt;item('protocol', 'email'));&#10;                //var_dump('error', 'Failed to send confirmation email to: ' . $this-&gt;input-&gt;post('email') . ' for candidate ID: ' . $candidat_id . '. Error: ' . $error);&#10;&#10;                return false;&#10;            }&#10;        } catch (Exception $e) {&#10;            log_message('error', 'Exception when sending email: ' . $e-&gt;getMessage());&#10;            return false;&#10;        }&#10;    }&#10;&#10;    public function add() {&#10;        $this-&gt;load-&gt;library('form_validation');&#10;        $table = 'candidats';&#10;        $data = array();&#10;        $submitname = &quot;enregistrer&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $data[&quot;specialites&quot;] = $this-&gt;model-&gt;list_all(&quot;specialite&quot;)-&gt;result();&#10;        $data[&quot;pays&quot;] = $this-&gt;model-&gt;list_all(&quot;pays&quot;)-&gt;result();&#10;        $data['action'] = site_url('candidature/add/');&#10;&#10;        // Log to help with debugging&#10;        log_message('debug', 'Add method accessed. POST data present: ' . (empty($_POST) ? 'No' : 'Yes'));&#10;&#10;        // Check if form is submitted&#10;        if ($this-&gt;input-&gt;post($submitname)) {&#10;            log_message('debug', 'Form submitted with button: ' . $submitname);&#10;            &#10;            // Set validation rules&#10;            $this-&gt;form_validation-&gt;set_rules('id_specialite', 'Spécialité', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('type_etude', 'Mode de formation', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('civilite', 'Civilité', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('nom', 'Nom', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('prenom', 'Prénom', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('date_naissance', 'Date de naissance', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('lieu_de_naissce', 'Lieu de naissance', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('nationalite', 'Nationalité', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('paysorigine', 'Pays d\'origine', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('statu_matrimonial', 'Statut matrimonial', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('adresse_candidat', 'Adresse complète', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('ville_residence', 'Ville de résidence', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('pays_residence', 'Pays de résidence', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('telephone', 'Téléphone WhatsApp', 'required|is_unique[candidats.telephone]|is_unique[candidats.telephone2]');&#10;            $this-&gt;form_validation-&gt;set_rules('telephone2', 'Téléphone secondaire', 'trim|differs[telephone]|is_unique[candidats.telephone]|is_unique[candidats.telephone2]');&#10;            $this-&gt;form_validation-&gt;set_rules('email', 'Email', 'required|valid_email|matches[emailverif]|is_unique[candidats.email]');&#10;            $this-&gt;form_validation-&gt;set_rules('emailverif', 'Confirmation Email', 'required');&#10;            $this-&gt;form_validation-&gt;set_rules('engagement', 'Engagement', 'required');&#10;&#10;            // Set custom error messages with clear and specific descriptions&#10;            $this-&gt;form_validation-&gt;set_message('required', 'Le champ %s est obligatoire.');&#10;            $this-&gt;form_validation-&gt;set_message('is_unique', 'Ce %s est déjà utilisé par un autre candidat. Veuillez en saisir un autre.');&#10;            $this-&gt;form_validation-&gt;set_message('matches', 'La confirmation de l\'adresse e-mail ne correspond pas à l\'adresse e-mail principale.');&#10;            $this-&gt;form_validation-&gt;set_message('differs', 'Le numéro de téléphone secondaire doit être différent du numéro principal.');&#10;            $this-&gt;form_validation-&gt;set_message('valid_email', 'Veuillez saisir une adresse e-mail valide.');&#10;&#10;            // Store form values for repopulation in case of validation failure&#10;            $this-&gt;form_data = new stdClass();&#10;            foreach ($this-&gt;input-&gt;post() as $key =&gt; $value) {&#10;                $this-&gt;form_data-&gt;$key = $value;&#10;            }&#10;            &#10;            $fields = ['type_etude', 'id_specialite', 'civilite', 'nom', 'prenom', 'epouse', 'nombre_enfant',&#10;                      'date_naissance', 'lieu_de_naissce', 'nationalite', 'paysorigine',&#10;                      'region_dorigine', 'dept_dorigine', 'sexe', 'statu_matrimonial', 'langue', 'pays_residence',&#10;                      'adresse_candidat', 'ville_residence', 'telephone', 'telephone2', 'email', 'emailverif',&#10;                      'dernier_diplome_intitule', 'dernier_diplome_specialite',&#10;                      'dernier_diplome_domaine', 'dernier_diplome_autre_domaine', 'dernier_diplome_etablissement',&#10;                      'dernier_diplome_pays', 'dernier_diplome_annee', 'dernier_diplome_niveau', 'dernier_diplome_mention',&#10;                      'statut_prof', 'autre_statut_prof', 'structure', 'adresse_structure', 'telephone_structure',&#10;                      'email_structure', 'poste_actuel', 'date_debut_poste', 'lien_finances_publiques',&#10;                      'explication_lien_partiel', 'total_annees_experience', 'howDidYouKnewUs', 'howDidYouKnewUs_autre'];&#10;                      &#10;            foreach ($fields as $field) {&#10;                if (!isset($this-&gt;form_data-&gt;$field)) {&#10;                    $this-&gt;form_data-&gt;$field = '';&#10;                }&#10;            }&#10;            &#10;            // Run validation and log the result&#10;            $validation_result = $this-&gt;form_validation-&gt;run();&#10;            log_message('debug', 'Form validation result: ' . ($validation_result ? 'PASSED' : 'FAILED'));&#10;            &#10;            if ($validation_result === TRUE) {&#10;                log_message('debug', 'Validation passed, proceeding with database insert');&#10;                &#10;                // Only save data if validation passes&#10;                $candidat_data = array();&#10;                foreach ($fields as $field) {&#10;                    if ($this-&gt;input-&gt;post($field) !== NULL) {&#10;                        $candidat_data[$field] = $this-&gt;input-&gt;post($field);&#10;                    }&#10;                }&#10;                &#10;                $candidat_data['date_naissance'] = $this-&gt;input-&gt;post('date_naissance');&#10;                $candidat_data['sexe'] = ($this-&gt;input-&gt;post('civilite') === &quot;Monsieur&quot;) ? &quot;Homme&quot; : &quot;Femme&quot;;&#10;                $candidat_data['accepter_condition'] = true;&#10;                $candidat_data['ordre_candidature'] = null;&#10;                $candidat_data['date_enregistrement'] = date(&quot;Y-m-d H:i:s&quot;);&#10;                $candidat_data['id_pays'] = $this-&gt;input-&gt;post('pays_residence');&#10;                $candidat_data['a_depose'] = false;&#10;&#10;                // Create the new record&#10;                $candidat_id = $this-&gt;model-&gt;create($table, $candidat_data);&#10;                log_message('debug', 'Database insert result: ' . ($candidat_id ? 'SUCCESS - ID: '.$candidat_id : 'FAILED'));&#10;                &#10;                if ($candidat_id) {&#10;                    // Send confirmation email to the candidate&#10;                    $email_sent = $this-&gt;send_confirmation_email($candidat_id, 'new');&#10;                    log_message('debug', 'Email sending result: ' . ($email_sent ? 'SUCCESS' : 'FAILED'));&#10;&#10;                    // Store info in session for the success page&#10;                    $this-&gt;session-&gt;set_flashdata('id', $candidat_id);&#10;                    $this-&gt;session-&gt;set_flashdata('numordre', $candidat_id);&#10;                    $this-&gt;session-&gt;set_flashdata('telephone', $this-&gt;input-&gt;post('telephone'));&#10;                    $this-&gt;session-&gt;set_flashdata('email', $this-&gt;input-&gt;post('email'));&#10;                    $this-&gt;session-&gt;set_flashdata('email_sent', $email_sent);&#10;&#10;                    // If email sending failed, get the error message&#10;                    if (!$email_sent) {&#10;                        $error = $this-&gt;email-&gt;print_debugger();&#10;                        $this-&gt;session-&gt;set_flashdata('email_error', $error);&#10;                        log_message('error', 'Email sending failed for candidate ID: ' . $candidat_id . '. Error: ' . $error);&#10;                    } else {&#10;                        log_message('info', 'Email successfully sent for candidate ID: ' . $candidat_id);&#10;                    }&#10;&#10;                    // Ensure the redirect URL is correct and properly formed&#10;                    $redirect_url = site_url('candidature/success');&#10;                    log_message('debug', 'Redirecting to success page: ' . $redirect_url);&#10;                    &#10;                    // Force a proper redirect with header&#10;                    header('Location: ' . $redirect_url);&#10;                    exit(); // Stop further execution to ensure the redirect takes place&#10;                } else {&#10;                    // Database insertion failed&#10;                    $data['error'] = 'Échec de l\'enregistrement de la candidature. Veuillez réessayer.';&#10;                    log_message('error', 'Failed to create candidate record in database');&#10;                    $this-&gt;template-&gt;layout('candidature', $data);&#10;                }&#10;            } else {&#10;                // Validation failed - log and display the form with errors&#10;                log_message('debug', 'Form validation failed. Errors: ' . validation_errors());&#10;                $this-&gt;template-&gt;layout('candidature', $data);&#10;            }&#10;        } else {&#10;            // First time loading the form - reset form data&#10;            log_message('debug', 'Initial form load - resetting form data');&#10;            $this-&gt;reset_form_data();&#10;            $this-&gt;template-&gt;layout('candidature', $data);&#10;        }&#10;    }&#10;&#10;    public function success() {&#10;        // Add detailed logging about the session data for debugging&#10;        log_message('debug', 'Success page accessed. Session data: ' . &#10;            'numordre=' . $this-&gt;session-&gt;flashdata('numordre') . ', ' .&#10;            'email=' . $this-&gt;session-&gt;flashdata('email') . ', ' . &#10;            'email_sent=' . ($this-&gt;session-&gt;flashdata('email_sent') ? 'true' : 'false'));&#10;            &#10;        $this-&gt;template-&gt;layout('success_page', array()); // Create a success view&#10;    }&#10;&#10;    public function viewnumordre(){&#10;        $data=array();&#10;        $this-&gt;template-&gt;layout('numOrdreCandidature', $data);&#10;    }&#10;&#10;    public function initupdate() {&#10;        $this-&gt;form_data = new stdclass;&#10;        $this-&gt;form_data-&gt;numordre = '';&#10;        $this-&gt;form_data-&gt;telephone = '';&#10;        $submitname = &quot;modifier&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $data['action'] = site_url('candidature/verifinitupdate/');&#10;        $this-&gt;template-&gt;layout('firstformupdate', $data);&#10;    }&#10;&#10;    public function verifinitupdate() {&#10;        $table = 'candidats';&#10;        $submitname = &quot;modifier&quot;;&#10;        $data['submitname'] = $submitname;&#10;        $numordre = $this-&gt;input-&gt;post('numordre');&#10;        $phone = $this-&gt;input-&gt;post('telephone');&#10;        $candidature = $this-&gt;model-&gt;get_by_id($table, $numordre, 'ordre_candidature')-&gt;row();&#10;        if ($candidature == null || $candidature-&gt;telephone !== $phone) {&#10;            $this-&gt;form_data = new stdclass;&#10;            $this-&gt;form_data-&gt;numordre = $this-&gt;input-&gt;post('numordre');&#10;            $this-&gt;form_data-&gt;telephone = $this-&gt;input-&gt;post('telephone');&#10;            $data['action'] = site_url('candidature/verifinitupdate/');&#10;            $data['message'] = &quot;Vérifier vos informations&quot;;&#10;            $this-&gt;template-&gt;layout('firstformupdate', $data);&#10;        } else {&#10;            redirect('candidature/update/'.$numordre.&quot;/&quot;.$phone);&#10;        }&#10;    }&#10;&#10;    public function marquerdeposer($id_candidat) {&#10;        $this-&gt;load-&gt;model('impression_model', '', TRUE);&#10;        $candidat = array(&#10;            'a_depose' =&gt; true&#10;        );&#10;        $this-&gt;model-&gt;update(&quot;candidats&quot;, 'id', $id_candidat, $candidat);&#10;        redirect('liste');&#10;    }&#10;&#10;    public function update($numordre = 0, $phone = '') {&#10;        $table = 'candidats';&#10;        $submitname = &quot;modifier&quot;;&#10;        $data['submitname'] = $submitname;&#10;&#10;        // Get candidate data&#10;        $candidature = $this-&gt;model-&gt;get_by_id($table, $numordre, 'ordre_candidature')-&gt;row();&#10;        if (!$candidature) {&#10;            // No candidate found with this order number&#10;            $this-&gt;session-&gt;set_flashdata('error', 'Aucune candidature trouvée avec ce numéro d\'ordre.');&#10;            redirect('candidature/initupdate');&#10;            return;&#10;        }&#10;&#10;        $data[&quot;specialites&quot;] = $this-&gt;model-&gt;list_all(&quot;specialite&quot;)-&gt;result();&#10;        $data[&quot;pays&quot;] = $this-&gt;model-&gt;list_all(&quot;pays&quot;)-&gt;result();&#10;        $data['action'] = site_url('candidature/update/'.$numordre.&quot;/&quot;.$phone);&#10;&#10;        // Load all current data into form_data&#10;        $this-&gt;form_data = new stdclass;&#10;        $this-&gt;form_data-&gt;type_etude = $candidature-&gt;type_etude;&#10;        $this-&gt;form_data-&gt;specialite = $candidature-&gt;id_specialite;&#10;        $this-&gt;form_data-&gt;civilite = $candidature-&gt;civilite;&#10;        $this-&gt;form_data-&gt;nom = $candidature-&gt;nom;&#10;        $this-&gt;form_data-&gt;prenom = $candidature-&gt;prenom;&#10;        $this-&gt;form_data-&gt;epouse = $candidature-&gt;epouse;&#10;        $this-&gt;form_data-&gt;nombre_enfant = $candidature-&gt;nombre_enfant;&#10;        $this-&gt;form_data-&gt;date_naissance = $candidature-&gt;date_naissance; // Use the date directly&#10;        $this-&gt;form_data-&gt;lieu_de_naissce = $candidature-&gt;lieu_de_naissce;&#10;        $this-&gt;form_data-&gt;nationalite = $candidature-&gt;nationalite;&#10;        $this-&gt;form_data-&gt;paysorigine = $candidature-&gt;paysorigine;&#10;        $this-&gt;form_data-&gt;region_dorigine = $candidature-&gt;region_dorigine;&#10;        $this-&gt;form_data-&gt;dept_dorigine = $candidature-&gt;dept_dorigine;&#10;        $this-&gt;form_data-&gt;sexe = $candidature-&gt;sexe;&#10;        $this-&gt;form_data-&gt;statu_matrimonial = $candidature-&gt;statu_matrimonial;&#10;        $this-&gt;form_data-&gt;langue = $candidature-&gt;langue;&#10;        $this-&gt;form_data-&gt;pays_residence = $candidature-&gt;id_pays;&#10;        $this-&gt;form_data-&gt;adresse_candidat = $candidature-&gt;adresse_candidat;&#10;        $this-&gt;form_data-&gt;ville_residence = $candidature-&gt;ville_residence;&#10;        $this-&gt;form_data-&gt;telephone = $candidature-&gt;telephone;&#10;        $this-&gt;form_data-&gt;telephone2 = $candidature-&gt;telephone2;&#10;        $this-&gt;form_data-&gt;email = $candidature-&gt;email;&#10;        $this-&gt;form_data-&gt;emailverif = $candidature-&gt;email;&#10;        $this-&gt;form_data-&gt;dernier_diplome_intitule = $candidature-&gt;dernier_diplome_intitule;&#10;        $this-&gt;form_data-&gt;dernier_diplome_specialite = $candidature-&gt;dernier_diplome_specialite;&#10;        $this-&gt;form_data-&gt;dernier_diplome_domaine = $candidature-&gt;dernier_diplome_domaine;&#10;        $this-&gt;form_data-&gt;dernier_diplome_autre_domaine = $candidature-&gt;dernier_diplome_autre_domaine;&#10;        $this-&gt;form_data-&gt;dernier_diplome_etablissement = $candidature-&gt;dernier_diplome_etablissement;&#10;        $this-&gt;form_data-&gt;dernier_diplome_pays = $candidature-&gt;dernier_diplome_pays;&#10;        $this-&gt;form_data-&gt;dernier_diplome_annee = $candidature-&gt;dernier_diplome_annee;&#10;        $this-&gt;form_data-&gt;dernier_diplome_niveau = $candidature-&gt;dernier_diplome_niveau;&#10;        $this-&gt;form_data-&gt;dernier_diplome_mention = $candidature-&gt;dernier_diplome_mention;&#10;        $this-&gt;form_data-&gt;statut_prof = $candidature-&gt;statut_prof;&#10;        $this-&gt;form_data-&gt;autre_statut_prof = $candidature-&gt;autre_statut_prof;&#10;        $this-&gt;form_data-&gt;structure = $candidature-&gt;structure;&#10;        $this-&gt;form_data-&gt;adresse_structure = $candidature-&gt;adresse_structure;&#10;        $this-&gt;form_data-&gt;telephone_structure = $candidature-&gt;telephone_structure;&#10;        $this-&gt;form_data-&gt;email_structure = $candidature-&gt;email_structure;&#10;        $this-&gt;form_data-&gt;poste_actuel = $candidature-&gt;poste_actuel;&#10;        $this-&gt;form_data-&gt;date_debut_poste = $candidature-&gt;date_debut_poste;&#10;        $this-&gt;form_data-&gt;lien_finances_publiques = $candidature-&gt;lien_finances_publiques;&#10;        $this-&gt;form_data-&gt;explication_lien_partiel = $candidature-&gt;explication_lien_partiel;&#10;        $this-&gt;form_data-&gt;total_annees_experience = $candidature-&gt;total_annees_experience;&#10;        $this-&gt;form_data-&gt;howDidYouKnewUs = $candidature-&gt;howDidYouKnewUs;&#10;        $this-&gt;form_data-&gt;howDidYouKnewUs_autre = $candidature-&gt;howDidYouKnewUs_autre;&#10;        //$this-&gt;form_data-&gt;accepter_condition              Pas besoin d'enregistrer cette variable&#10;&#10;        if (isset($_POST[$submitname])) {&#10;            // Validation rules for update - exclude current record from uniqueness check&#10;            $this-&gt;form_validation-&gt;set_rules('telephone', 'Numéro de téléphone principal', 'trim|required|is_unique[candidats.telephone.id.' . $candidature-&gt;id . ']|is_unique[candidats.telephone2.id.' . $candidature-&gt;id . ']');&#10;            $this-&gt;form_validation-&gt;set_rules('telephone2', 'Numéro de téléphone secondaire', 'trim|is_unique[candidats.telephone2.id.' . $candidature-&gt;id . ']|is_unique[candidats.telephone.id.' . $candidature-&gt;id . ']|differs[telephone]');&#10;            $this-&gt;form_validation-&gt;set_rules('email', 'Adresse e-mail', 'trim|required|valid_email|is_unique[candidats.email.id.' . $candidature-&gt;id . ']');&#10;            $this-&gt;form_validation-&gt;set_rules('emailverif', 'Confirmation de l\'adresse e-mail', 'trim|required|valid_email|matches[email]');&#10;            $this-&gt;form_validation-&gt;set_rules('date_naissance', 'Date de naissance', 'required');&#10;&#10;            // Set custom error messages with clear and specific descriptions&#10;            $this-&gt;form_validation-&gt;set_message('required', 'Le champ %s est obligatoire.');&#10;            $this-&gt;form_validation-&gt;set_message('is_unique', 'Ce %s est déjà utilisé par un autre candidat. Veuillez en saisir un autre.');&#10;            $this-&gt;form_validation-&gt;set_message('matches', 'La confirmation de l\'adresse e-mail ne correspond pas à l\'adresse e-mail principale.');&#10;            $this-&gt;form_validation-&gt;set_message('differs', 'Le numéro de téléphone secondaire doit être différent du numéro principal.');&#10;            $this-&gt;form_validation-&gt;set_message('valid_email', 'Veuillez saisir une adresse e-mail valide.');&#10;&#10;            // Store form values for repopulation in case of validation failure&#10;            foreach ($this-&gt;input-&gt;post() as $key =&gt; $value) {&#10;                $this-&gt;form_data-&gt;$key = $value;&#10;            }&#10;&#10;            if ($this-&gt;form_validation-&gt;run() == TRUE) {&#10;                // Build update data array with all fields&#10;                $candidat = array(&#10;                    'civilite' =&gt; $this-&gt;input-&gt;post('civilite'),&#10;                    'type_etude' =&gt; $this-&gt;input-&gt;post('type_etude'),&#10;                    'nom' =&gt; $this-&gt;input-&gt;post('nom'),&#10;                    'prenom' =&gt; $this-&gt;input-&gt;post('prenom'),&#10;                    'epouse' =&gt; $this-&gt;input-&gt;post('epouse'),&#10;                    'nombre_enfant' =&gt; $this-&gt;input-&gt;post('nombre_enfant'),&#10;                    'date_naissance' =&gt; $this-&gt;input-&gt;post('date_naissance'),&#10;                    'lieu_de_naissce' =&gt; $this-&gt;input-&gt;post('lieu_de_naissce'),&#10;                    'nationalite' =&gt; $this-&gt;input-&gt;post('nationalite'),&#10;                    'paysorigine' =&gt; $this-&gt;input-&gt;post('paysorigine'),&#10;                    'region_dorigine' =&gt; $this-&gt;input-&gt;post('region_dorigine'),&#10;                    'dept_dorigine' =&gt; $this-&gt;input-&gt;post('dept_dorigine'),&#10;                    'statu_matrimonial' =&gt; $this-&gt;input-&gt;post('statu_matrimonial'),&#10;                    'adresse_candidat' =&gt; $this-&gt;input-&gt;post('adresse_candidat'),&#10;                    'telephone' =&gt; $this-&gt;input-&gt;post('telephone'),&#10;                    'telephone2' =&gt; $this-&gt;input-&gt;post('telephone2'),&#10;                    'email' =&gt; $this-&gt;input-&gt;post('email'),&#10;                    'ville_residence' =&gt; $this-&gt;input-&gt;post('ville_residence'),&#10;                    'dernier_diplome_intitule' =&gt; $this-&gt;input-&gt;post('dernier_diplome_intitule'),&#10;                    'dernier_diplome_specialite' =&gt; $this-&gt;input-&gt;post('dernier_diplome_specialite'),&#10;                    'dernier_diplome_domaine' =&gt; $this-&gt;input-&gt;post('dernier_diplome_domaine'),&#10;                    'dernier_diplome_autre_domaine' =&gt; $this-&gt;input-&gt;post('dernier_diplome_autre_domaine'),&#10;                    'dernier_diplome_etablissement' =&gt; $this-&gt;input-&gt;post('dernier_diplome_etablissement'),&#10;                    'dernier_diplome_pays' =&gt; $this-&gt;input-&gt;post('dernier_diplome_pays'),&#10;                    'dernier_diplome_annee' =&gt; $this-&gt;input-&gt;post('dernier_diplome_annee'),&#10;                    'dernier_diplome_niveau' =&gt; $this-&gt;input-&gt;post('dernier_diplome_niveau'),&#10;                    'dernier_diplome_mention' =&gt; $this-&gt;input-&gt;post('dernier_diplome_mention'),&#10;                    'statut_prof' =&gt; $this-&gt;input-&gt;post('statut_prof'),&#10;                    'autre_statut_prof' =&gt; $this-&gt;input-&gt;post('autre_statut_prof'),&#10;                    'structure' =&gt; $this-&gt;input-&gt;post('structure'),&#10;                    'adresse_structure' =&gt; $this-&gt;input-&gt;post('adresse_structure'),&#10;                    'email_structure' =&gt; $this-&gt;input-&gt;post('email_structure'),&#10;                    'telephone_structure' =&gt; $this-&gt;input-&gt;post('telephone_structure'),&#10;                    'poste_actuel' =&gt; $this-&gt;input-&gt;post('poste_actuel'),&#10;                    'date_debut_poste' =&gt; $this-&gt;input-&gt;post('date_debut_poste'),&#10;                    'lien_finances_publiques' =&gt; $this-&gt;input-&gt;post('lien_finances_publiques'),&#10;                    'explication_lien_partiel' =&gt; $this-&gt;input-&gt;post('explication_lien_partiel'),&#10;                    'total_annees_experience' =&gt; $this-&gt;input-&gt;post('total_annees_experience'),&#10;                    'howDidYouKnewUs' =&gt; $this-&gt;input-&gt;post('howDidYouKnewUs'),&#10;                    'howDidYouKnewUs_autre' =&gt; $this-&gt;input-&gt;post('howDidYouKnewUs_autre'),&#10;                    'langue' =&gt; $this-&gt;input-&gt;post('langue'),&#10;                    'id_specialite' =&gt; $this-&gt;input-&gt;post('pays_residence'),&#10;                    'id_pays' =&gt; $this-&gt;input-&gt;post('pays_residence'),&#10;                    'pays_residence' =&gt; $this-&gt;model-&gt;get_by_id(&quot;pays&quot;, $this-&gt;input-&gt;post('pays_residence'), &quot;id&quot;)-&gt;row()-&gt;nom,&#10;                    'date_enregistrement' =&gt; date(&quot;Y-m-d H:i:s&quot;),&#10;                    'sexe' =&gt; ($this-&gt;input-&gt;post('civilite') === &quot;Monsieur&quot;) ? &quot;Homme&quot; : &quot;Femme&quot;,&#10;                    'accepter_condition' =&gt; true&#10;                );&#10;&#10;                // Update the record&#10;                $update_result = $this-&gt;model-&gt;update($table, 'id', $candidature-&gt;id, $candidat);&#10;&#10;                if ($update_result) {&#10;                    // Send confirmation email to the candidate&#10;                    $email_sent = $this-&gt;send_confirmation_email($candidature, 'update');&#10;&#10;                    $this-&gt;session-&gt;set_flashdata('succes', 'Modification de la Candidature enregistrée avec succès, votre numéro d\'ordre a été envoyé à votre adresse mail!');&#10;                    $this-&gt;session-&gt;set_flashdata('id', $candidature-&gt;ordre_candidature);&#10;                    $this-&gt;session-&gt;set_flashdata('numordre', $candidature-&gt;ordre_candidature);&#10;                    $this-&gt;session-&gt;set_flashdata('telephone', $this-&gt;input-&gt;post('telephone'));&#10;                    $this-&gt;session-&gt;set_flashdata('email', $this-&gt;input-&gt;post('email'));&#10;                    $this-&gt;session-&gt;set_flashdata('email_sent', $email_sent);&#10;&#10;                    // If email sending failed, get the error message&#10;                    if (!$email_sent) {&#10;                        $error = $this-&gt;email-&gt;print_debugger();&#10;                        $this-&gt;session-&gt;set_flashdata('email_error', $error);&#10;                        log_message('error', 'Email sending failed for update of candidate ID: ' . $candidature-&gt;id . '. Error: ' . $error);&#10;                    } else {&#10;                        log_message('info', 'Email successfully sent for update of candidate ID: ' . $candidature-&gt;id);&#10;                    }&#10;&#10;                    // Redirect to prevent form resubmission&#10;                    redirect('candidature/viewnumordre');&#10;                } else {&#10;                    // Database update failed&#10;                    $data['message'] = 'Échec de la mise à jour de la candidature. Veuillez réessayer.';&#10;                    $this-&gt;template-&gt;layout('candidature', $data);&#10;                }&#10;            } else {&#10;                // Validation failed&#10;                $data['message'] = 'Des erreurs ont été rencontrées lors de l\'enregistrement de votre fiche&lt;br/&gt; verifier vos informations et corriger les problèmes signalés';&#10;                $this-&gt;template-&gt;layout('candidature', $data);&#10;            }&#10;        } else {&#10;            // Initial page load - just display the form&#10;            $this-&gt;template-&gt;layout('candidature', $data);&#10;        }&#10;    }&#10;&#10;    public function initRecupOrdre(){&#10;        $data=array();&#10;        $this-&gt;template-&gt;layout('formEmailForNumOrdre', array());&#10;    }&#10;&#10;    /**&#10;     * Reset form data by initializing all properties to empty values&#10;     */&#10;    private function reset_form_data() {&#10;        // Initialize form_data object if it doesn't exist&#10;        if (!isset($this-&gt;form_data)) {&#10;            $this-&gt;form_data = new stdClass();&#10;        }&#10;&#10;        // Reset all form fields to empty values&#10;        $this-&gt;form_data-&gt;specialite = '';&#10;        $this-&gt;form_data-&gt;type_etude = '';&#10;        $this-&gt;form_data-&gt;civilite = '';&#10;        $this-&gt;form_data-&gt;nom = '';&#10;        $this-&gt;form_data-&gt;prenom = '';&#10;        $this-&gt;form_data-&gt;epouse = '';&#10;        $this-&gt;form_data-&gt;nombre_enfant = '';&#10;        $this-&gt;form_data-&gt;datenaiss_jj = '';&#10;        $this-&gt;form_data-&gt;datenaiss_mm = '';&#10;        $this-&gt;form_data-&gt;datenaiss_yy = '';&#10;        $this-&gt;form_data-&gt;lieu_de_naissce = '';&#10;        $this-&gt;form_data-&gt;nationalite = '';&#10;        $this-&gt;form_data-&gt;paysorigine = '';&#10;        $this-&gt;form_data-&gt;region_dorigine = '';&#10;        $this-&gt;form_data-&gt;dept_dorigine = '';&#10;        $this-&gt;form_data-&gt;sexe = '';&#10;        $this-&gt;form_data-&gt;statu_matrimonial = '';&#10;        $this-&gt;form_data-&gt;langue = '';&#10;        $this-&gt;form_data-&gt;pays_residence = '';&#10;        $this-&gt;form_data-&gt;adresse_candidat = '';&#10;        $this-&gt;form_data-&gt;ville_residence = '';&#10;        $this-&gt;form_data-&gt;telephone = '';&#10;        $this-&gt;form_data-&gt;telephone2 = '';&#10;        $this-&gt;form_data-&gt;email = '';&#10;        $this-&gt;form_data-&gt;emailverif = '';&#10;        $this-&gt;form_data-&gt;nombre_annee_etude_sup = '';&#10;        $this-&gt;form_data-&gt;dernier_diplome = '';&#10;        $this-&gt;form_data-&gt;specialite_requise = '';&#10;        $this-&gt;form_data-&gt;diplome_requis = '';&#10;        $this-&gt;form_data-&gt;diplome_obtenu_a = '';&#10;        $this-&gt;form_data-&gt;annee_optention_diplome = '';&#10;        $this-&gt;form_data-&gt;statut_prof = '';&#10;        $this-&gt;form_data-&gt;structure = '';&#10;        $this-&gt;form_data-&gt;adresse_structure = '';&#10;        $this-&gt;form_data-&gt;telephone_structure = '';&#10;        $this-&gt;form_data-&gt;email_structure = '';&#10;        $this-&gt;form_data-&gt;howDidYouKnewUs = '';&#10;    }&#10;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/application/views/success_page.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/application/views/success_page.php" />
              <option name="updatedContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;fr&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;title&gt;Candidature Soumise avec Succès&lt;/title&gt;&#10;    &lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;?= base_url() ?&gt;resources/css/modern-form.css&quot;&gt;&#10;    &lt;style&gt;&#10;        .success-container {&#10;            text-align: center;&#10;            padding: 40px;&#10;            border-radius: 8px;&#10;            background-color: #fff;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            margin: 40px auto;&#10;            max-width: 600px;&#10;        }&#10;        .success-icon {&#10;            font-size: 48px;&#10;            color: #28a745;&#10;        }&#10;        .success-icon.error {&#10;            color: #dc3545;&#10;        }&#10;        .success-title {&#10;            font-size: 24px;&#10;            margin-top: 20px;&#10;            color: #333;&#10;        }&#10;        .success-message {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;        }&#10;        .success-actions {&#10;            margin-top: 30px;&#10;        }&#10;        .btn {&#10;            padding: 10px 20px;&#10;            border-radius: 5px;&#10;            text-decoration: none;&#10;            color: #fff;&#10;            font-weight: bold;&#10;            margin: 0 10px;&#10;        }&#10;        .btn-primary {&#10;            background-color: #007bff;&#10;        }&#10;        .btn-secondary {&#10;            background-color: #6c757d;&#10;        }&#10;        .candidate-info {&#10;            margin: 20px 0;&#10;            background-color: #f8f9fa;&#10;            padding: 20px;&#10;            border-radius: 5px;&#10;            text-align: left;&#10;        }&#10;        .candidate-info h3 {&#10;            border-bottom: 1px solid #dee2e6;&#10;            padding-bottom: 10px;&#10;            margin-bottom: 15px;&#10;            color: #495057;&#10;        }&#10;        .candidate-info p {&#10;            margin: 8px 0;&#10;        }&#10;        .info-label {&#10;            font-weight: bold;&#10;            color: #495057;&#10;        }&#10;        .email-status {&#10;            margin-top: 20px;&#10;            padding: 10px;&#10;            border-radius: 4px;&#10;        }&#10;        .status-success {&#10;            background-color: #d4edda;&#10;            color: #155724;&#10;            border: 1px solid #c3e6cb;&#10;        }&#10;        .status-error {&#10;            background-color: #f8d7da;&#10;            color: #721c24;&#10;            border: 1px solid #f5c6cb;&#10;        }&#10;        .error-details {&#10;            font-family: monospace;&#10;            background: #f8f8f8;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 4px;&#10;            margin-top: 10px;&#10;            white-space: pre-wrap;&#10;            text-align: left;&#10;            max-height: 200px;&#10;            overflow: auto;&#10;            font-size: 12px;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;success-container&quot;&gt;&#10;            &lt;div class=&quot;success-icon &lt;?= $this-&gt;session-&gt;flashdata('email_sent') ? '' : 'error' ?&gt;&quot;&gt;&#10;                &lt;i class=&quot;&lt;?= $this-&gt;session-&gt;flashdata('email_sent') ? 'fas fa-check-circle' : 'fas fa-exclamation-circle' ?&gt;&quot;&gt;&lt;/i&gt;&#10;            &lt;/div&gt;&#10;            &lt;h1 class=&quot;success-title&quot;&gt;Candidature soumise avec succès !&lt;/h1&gt;&#10;            &#10;            &lt;div class=&quot;candidate-info&quot;&gt;&#10;                &lt;h3&gt;Informations de votre candidature&lt;/h3&gt;&#10;                &lt;p&gt;&lt;span class=&quot;info-label&quot;&gt;Numéro de dossier :&lt;/span&gt; &lt;?= $this-&gt;session-&gt;flashdata('numordre') ?&gt;&lt;/p&gt;&#10;                &lt;p&gt;&lt;span class=&quot;info-label&quot;&gt;Téléphone :&lt;/span&gt; &lt;?= $this-&gt;session-&gt;flashdata('telephone') ?&gt;&lt;/p&gt;&#10;                &lt;p&gt;&lt;span class=&quot;info-label&quot;&gt;Email :&lt;/span&gt; &lt;?= $this-&gt;session-&gt;flashdata('email') ?&gt;&lt;/p&gt;&#10;                &#10;                &lt;div class=&quot;email-status &lt;?= $this-&gt;session-&gt;flashdata('email_sent') ? 'status-success' : 'status-error' ?&gt;&quot;&gt;&#10;                    &lt;?php if ($this-&gt;session-&gt;flashdata('email_sent')): ?&gt;&#10;                        &lt;p&gt;&lt;i class=&quot;fas fa-check&quot;&gt;&lt;/i&gt; Un email de confirmation a été envoyé à votre adresse email.&lt;/p&gt;&#10;                    &lt;?php else: ?&gt;&#10;                        &lt;p&gt;&lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt; Nous n'avons pas pu envoyer l'email de confirmation.&lt;/p&gt;&#10;                        &lt;p&gt;Veuillez noter précieusement les informations ci-dessus et contacter l'administration si nécessaire.&lt;/p&gt;&#10;                        &#10;                        &lt;?php if ($this-&gt;session-&gt;flashdata('email_error')): ?&gt;&#10;                            &lt;div class=&quot;error-details&quot;&gt;&#10;                                &lt;?= $this-&gt;session-&gt;flashdata('email_error') ?&gt;&#10;                            &lt;/div&gt;&#10;                        &lt;?php endif; ?&gt;&#10;                    &lt;?php endif; ?&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;p class=&quot;success-message&quot;&gt;&#10;                Merci d'avoir soumis votre candidature. Veuillez conserver précieusement votre numéro de dossier.&#10;            &lt;/p&gt;&#10;            &#10;            &lt;div class=&quot;success-actions&quot;&gt;&#10;                &lt;a href=&quot;&lt;?= site_url('impression/imprimer_fiche/' . $this-&gt;session-&gt;flashdata('numordre')) ?&gt;&quot; class=&quot;btn btn-primary&quot;&gt;Télécharger ma fiche&lt;/a&gt;&#10;                &lt;a href=&quot;&lt;?= site_url('candidature') ?&gt;&quot; class=&quot;btn btn-secondary&quot;&gt;Retour à l'accueil&lt;/a&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js&quot;&gt;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/db_update.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/db_update.sql" />
              <option name="originalContent" value="-- Script SQL pour mettre à jour la structure de la base de données epole_candi_p12_2024&#10;-- Ajout des champs manquants pour correspondre aux formulaires mis à jour&#10;-- Date: 03-08-2025&#10;&#10;-- 1. Ajout des nouveaux champs liés au diplôme&#10;ALTER TABLE `candidats`&#10;    ADD COLUMN `dernier_diplome_intitule` VARCHAR(255) NULL COMMENT 'Intitulé exact du dernier diplôme' AFTER `dernier_diplome`,&#10;    ADD COLUMN `dernier_diplome_specialite` VARCHAR(255) NULL COMMENT 'Spécialité/Filière du diplôme' AFTER `dernier_diplome_intitule`,&#10;    ADD COLUMN `dernier_diplome_domaine` VARCHAR(100) NULL COMMENT 'Domaine principal du diplôme' AFTER `dernier_diplome_specialite`,&#10;    ADD COLUMN `dernier_diplome_autre_domaine` VARCHAR(255) NULL COMMENT 'Précision si domaine = Autre' AFTER `dernier_diplome_domaine`,&#10;    ADD COLUMN `dernier_diplome_etablissement` VARCHAR(255) NULL COMMENT 'Établissement d\'obtention du diplôme' AFTER `dernier_diplome_autre_domaine`,&#10;    ADD COLUMN `dernier_diplome_pays` INT NULL COMMENT 'ID du pays de l\'établissement' AFTER `dernier_diplome_etablissement`,&#10;    ADD COLUMN `dernier_diplome_annee` INT NULL COMMENT 'Année d\'obtention du diplôme' AFTER `dernier_diplome_pays`,&#10;    ADD COLUMN `dernier_diplome_niveau` VARCHAR(50) NULL COMMENT 'Niveau académique (BAC+3, BAC+4, etc.)' AFTER `dernier_diplome_annee`,&#10;    ADD COLUMN `dernier_diplome_mention` VARCHAR(50) NULL COMMENT 'Mention obtenue' AFTER `dernier_diplome_niveau`;&#10;&#10;-- 2. Ajout des nouveaux champs professionnels&#10;ALTER TABLE `candidats`&#10;    ADD COLUMN `autre_statut_prof` VARCHAR(255) NULL COMMENT 'Précision si statut = Autre' AFTER `statut_prof`,&#10;    ADD COLUMN `poste_actuel` VARCHAR(255) NULL COMMENT 'Poste occupé actuellement' AFTER `email_structure`,&#10;    ADD COLUMN `date_debut_poste` VARCHAR(20) NULL COMMENT 'Date de début du poste actuel' AFTER `poste_actuel`,&#10;    ADD COLUMN `lien_finances_publiques` VARCHAR(50) NULL COMMENT 'Lien du poste avec les finances publiques' AFTER `date_debut_poste`,&#10;    ADD COLUMN `explication_lien_partiel` TEXT NULL COMMENT 'Explication si lien partiel' AFTER `lien_finances_publiques`,&#10;    ADD COLUMN `total_annees_experience` DECIMAL(5,1) NULL COMMENT 'Nombre total d\'années d\'expérience' AFTER `explication_lien_partiel`;&#10;&#10;-- 3. Ajout du champ pour le détail de la source d'information&#10;ALTER TABLE `candidats`&#10;    ADD COLUMN `howDidYouKnewUs_autre` VARCHAR(255) NULL COMMENT 'Précision si source = Autre' AFTER `howDidYouKnewUs`;&#10;&#10;&#10;-- 5. Création d'index pour améliorer les performances&#10;CREATE INDEX idx_candidats_diplome_pays ON candidats(dernier_diplome_pays);&#10;CREATE INDEX idx_candidats_specialite ON candidats(id_specialite);&#10;CREATE INDEX idx_candidats_pays ON candidats(id_pays);&#10;CREATE INDEX idx_candidats_email ON candidats(email);&#10;&#10;-- 6. Mise à jour des vues pour inclure les nouveaux champs&#10;DROP VIEW IF EXISTS `candidature2024`;&#10;CREATE VIEW `candidature2024` AS&#10;SELECT&#10;    c.*,&#10;    s.nom AS specialite,&#10;    p.nom AS pays&#10;FROM&#10;    candidats c&#10;    JOIN pays p ON c.id_pays = p.id&#10;    JOIN specialite s ON c.id_specialite = s.id&#10;WHERE&#10;    c.a_depose = 1;&#10;&#10;DROP VIEW IF EXISTS `candidatureFull2023`;&#10;CREATE VIEW `candidatureFull2023` AS&#10;SELECT&#10;    c.*,&#10;    p.nom AS pays,&#10;    s.nom AS specialite&#10;FROM&#10;    candidats c&#10;    JOIN specialite s ON c.id_specialite = s.id&#10;    JOIN pays p ON c.id_pays = p.id;&#10;" />
              <option name="updatedContent" value="-- Script SQL pour mettre à jour la structure de la base de données epole_candi_p12_2024&#10;-- Ajout des champs manquants pour correspondre aux formulaires mis à jour&#10;-- Date: 03-08-2025&#10;&#10;-- 1. Ajout des nouveaux champs liés au diplôme&#10;ALTER TABLE `candidats`&#10;    ADD COLUMN `dernier_diplome_intitule` VARCHAR(255) NULL COMMENT 'Intitulé exact du dernier diplôme' AFTER `dernier_diplome`,&#10;    ADD COLUMN `dernier_diplome_specialite` VARCHAR(255) NULL COMMENT 'Spécialité/Filière du diplôme' AFTER `dernier_diplome_intitule`,&#10;    ADD COLUMN `dernier_diplome_domaine` VARCHAR(100) NULL COMMENT 'Domaine principal du diplôme' AFTER `dernier_diplome_specialite`,&#10;    ADD COLUMN `dernier_diplome_autre_domaine` VARCHAR(255) NULL COMMENT 'Précision si domaine = Autre' AFTER `dernier_diplome_domaine`,&#10;    ADD COLUMN `dernier_diplome_etablissement` VARCHAR(255) NULL COMMENT 'Établissement d\'obtention du diplôme' AFTER `dernier_diplome_autre_domaine`,&#10;    ADD COLUMN `dernier_diplome_pays` INT NULL COMMENT 'ID du pays de l\'établissement' AFTER `dernier_diplome_etablissement`,&#10;    ADD COLUMN `dernier_diplome_annee` INT NULL COMMENT 'Année d\'obtention du diplôme' AFTER `dernier_diplome_pays`,&#10;    ADD COLUMN `dernier_diplome_niveau` VARCHAR(50) NULL COMMENT 'Niveau académique (BAC+3, BAC+4, etc.)' AFTER `dernier_diplome_annee`,&#10;    ADD COLUMN `dernier_diplome_mention` VARCHAR(50) NULL COMMENT 'Mention obtenue' AFTER `dernier_diplome_niveau`;&#10;&#10;-- 2. Ajout des nouveaux champs professionnels&#10;ALTER TABLE `candidats`&#10;    ADD COLUMN `autre_statut_prof` VARCHAR(255) NULL COMMENT 'Précision si statut = Autre' AFTER `statut_prof`,&#10;    ADD COLUMN `poste_actuel` VARCHAR(255) NULL COMMENT 'Poste occupé actuellement' AFTER `email_structure`,&#10;    ADD COLUMN `date_debut_poste` VARCHAR(20) NULL COMMENT 'Date de début du poste actuel' AFTER `poste_actuel`,&#10;    ADD COLUMN `lien_finances_publiques` VARCHAR(50) NULL COMMENT 'Lien du poste avec les finances publiques' AFTER `date_debut_poste`,&#10;    ADD COLUMN `explication_lien_partiel` TEXT NULL COMMENT 'Explication si lien partiel' AFTER `lien_finances_publiques`,&#10;    ADD COLUMN `total_annees_experience` DECIMAL(5,1) NULL COMMENT 'Nombre total d\'années d\'expérience' AFTER `explication_lien_partiel`;&#10;&#10;-- 3. Ajout du champ pour le détail de la source d'information&#10;ALTER TABLE `candidats`&#10;    ADD COLUMN `howDidYouKnewUs_autre` VARCHAR(255) NULL COMMENT 'Précision si source = Autre' AFTER `howDidYouKnewUs`;&#10;&#10;-- 4. Suppression des champs qui ne sont plus utilisés dans le formulaire&#10;ALTER TABLE `candidats`&#10;    DROP COLUMN `specialite_requise`,&#10;    DROP COLUMN `diplome_requis`,&#10;    DROP COLUMN `annee_optention_diplome`,&#10;    DROP COLUMN `diplome_obtenu_a`,&#10;    DROP COLUMN `dernier_diplome`,&#10;    DROP COLUMN `nombre_annee_etude_sup`;&#10;&#10;-- 5. Création d'index pour améliorer les performances&#10;CREATE INDEX idx_candidats_diplome_pays ON candidats(dernier_diplome_pays);&#10;CREATE INDEX idx_candidats_specialite ON candidats(id_specialite);&#10;CREATE INDEX idx_candidats_pays ON candidats(id_pays);&#10;CREATE INDEX idx_candidats_email ON candidats(email);&#10;&#10;-- 6. Mise à jour des vues pour inclure les nouveaux champs&#10;DROP VIEW IF EXISTS `candidature2024`;&#10;CREATE VIEW `candidature2024` AS&#10;SELECT&#10;    c.*,&#10;    s.nom AS specialite,&#10;    p.nom AS pays&#10;FROM&#10;    candidats c&#10;    JOIN pays p ON c.id_pays = p.id&#10;    JOIN specialite s ON c.id_specialite = s.id&#10;WHERE&#10;    c.a_depose = 1;&#10;&#10;DROP VIEW IF EXISTS `candidatureFull2023`;&#10;CREATE VIEW `candidatureFull2023` AS&#10;SELECT&#10;    c.*,&#10;    p.nom AS pays,&#10;    s.nom AS specialite&#10;FROM&#10;    candidats c&#10;    JOIN specialite s ON c.id_specialite = s.id&#10;    JOIN pays p ON c.id_pays = p.id;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>